@model List<KDemia.Models.Course>

@{
    ViewData["Title"] = "Eğitim Listesi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* KART TASARIMI */
    .course-card {
        background: #fff;
        border: none;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Yaylanma efekti */
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

        /* Hover Durumu: Kart büyür ve gölgesi artar */
        .course-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            z-index: 20;
        }

    /* RESİM YERİNE RENKLİ BAŞLIK */
    .course-header-gradient {
        height: 100px; /* Daha kısa, kompakt */
        background: linear-gradient(135deg, #0088cc 0%, #4e4376 100%);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Ortadaki İkon */
    .course-icon-overlay {
        font-size: 3rem;
        color: rgba(255, 255, 255, 0.2);
    }

    /* BADGE (ETİKET) POZİSYONLARI */
    .status-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 10px;
        padding: 3px 8px;
        border-radius: 4px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .category-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        color: #fff;
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: 600;
        border: 1px solid rgba(255,255,255,0.3);
    }

    /* İÇERİK ALANI */
    .card-content {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .course-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* AÇIKLAMA: Hover ile açılan kısım */
    .course-desc {
        font-size: 0.85rem;
        color: #777;
        margin-bottom: 15px;
        /* Varsayılan: Sadece 2 satır göster */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        transition: max-height 0.5s ease;
        max-height: 40px; /* Yaklaşık 2 satır yüksekliği */
    }

    /* Hover olunca açıklama uzasın */
    .course-card:hover .course-desc {
        -webkit-line-clamp: unset; /* Satır sınırını kaldır */
        max-height: 200px; /* Yeterince büyük bir değer */
        overflow: visible;
    }

    .instructor-row {
        font-size: 0.8rem;
        color: #999;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
    }

    /* FİYAT VE BUTONLAR */
    .card-footer-custom {
        margin-top: auto; /* En alta itmek için */
        padding-top: 10px;
        border-top: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .price-tag {
        font-weight: 800;
        color: #0088cc;
        font-size: 1.1rem;
    }

</style>

<section class="card">
    <header class="card-header">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h2 class="card-title">Eğitim Listesi</h2>
            </div>
            <div class="col-md-6 text-right" style="text-align: right;">
                <a href="/Course/Create" class="btn btn-primary btn-success btn-sm">
                    <i class="fas fa-plus"></i> Yeni Eğitim Ekle
                </a>
            </div>
        </div>
    </header>

    <div class="card-body" style="background-color: #f6f7f9;">

        <div class="row mb-4">
            <div class="col-lg-12">
                <form method="get" action="/Course/Index">
                    <div class="card p-3 shadow-sm border-0">
                        <div class="row">
                            <div class="col-md-5 mb-2 mb-md-0">
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-0"><i class="fas fa-search"></i></span>
                                    <input type="text" name="search" class="form-control border-0 bg-light"
                                           placeholder="Eğitim adı veya açıklama ara..."
                                           value="@ViewBag.CurrentSearch">
                                </div>
                            </div>

                            <div class="col-md-4 mb-2 mb-md-0">
                                <select name="categoryId" class="form-control border-0 bg-light" asp-items="ViewBag.Categories">
                                    <option value="">-- Tüm Kategoriler --</option>
                                </select>
                            </div>

                            <div class="col-md-3">
                                <button type="submit" class="btn btn-secondary btn-block w-100">
                                    Filtrele
                                </button>
                                @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch) || ViewBag.CurrentCategory != null)
                                {
                                    <a href="/Course/Index" class="btn btn-link btn-sm btn-block text-danger mt-1">
                                        Temizle
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="row">
            @foreach (var item in Model)
            {
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="course-card">

                        <div class="course-header-gradient">
                            <i class="fas fa-laptop-code course-icon-overlay"></i>

                            <span class="category-badge">
                                @(item.Category?.Name ?? "Genel")
                            </span>

                            @if (item.IsPublished)
                            {
                                <span class="status-badge badge-success bg-success text-white">Yayında</span>
                            }
                            else
                            {
                                <span class="status-badge badge-danger bg-danger text-white">Taslak</span>
                            }
                        </div>

                        <div class="card-content">
                            <div class="course-title" title="@item.Title">
                                @item.Title
                            </div>

                            <div class="instructor-row">
                                <i class="fas fa-user-circle mr-2"></i>
                                <span>@(item.User?.FullName ?? "Bilinmiyor")</span>
                            </div>

                            <div class="course-desc">
                                @(item.ShortDescription ?? "Açıklama bulunmuyor.")
                            </div>

                            <div class="card-footer-custom">
                                <div class="price-tag">
                                    @item.Price.ToString("C2")
                                </div>

                                <div>
                                    @if (!string.IsNullOrEmpty(item.VideoUrl))
                                    {
                                        string iconClass = "fas fa-play";
                                        string btnClass = "btn-outline-secondary";
                                        string tooltip = "İzle";

                                        if (item.VideoSource == "YouTube") { iconClass = "fab fa-youtube"; btnClass = "btn-outline-danger"; tooltip = "YouTube"; }
                                        else if (item.VideoSource == "Vimeo") { iconClass = "fab fa-vimeo-v"; btnClass = "btn-outline-info"; tooltip = "Vimeo"; }
                                        else if (item.VideoSource == "Dailymotion") { iconClass = "fab fa-dailymotion"; btnClass = "btn-outline-dark"; tooltip = "Dailymotion"; }

                                        <a href="@item.VideoUrl" target="_blank" class="btn btn-xs @btnClass" title="@tooltip">
                                            <i class="@iconClass"></i>
                                        </a>
                                    }

                                    <a href="/Course/Edit/@item.Id" class="btn btn-xs btn-warning text-white" title="Düzenle">
                                        <i class="fas fa-pencil-alt"></i>
                                    </a>

                                    <button onclick="deleteCourse(@item.Id)" class="btn btn-xs btn-danger" title="Sil">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            }
        </div>

        @if (Model.Count == 0)
        {
            <div class="alert alert-warning text-center p-4">
                <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <h4>Sonuç Bulunamadı</h4>
                <p>Aradığınız kriterlere uygun bir eğitim bulunmamaktadır.</p>
                <a href="/Course/Index" class="btn btn-dark btn-sm">Tüm Eğitimleri Göster</a>
            </div>
        }

    </div>
</section>

@section Scripts {
    <script>
        function deleteCourse(id) {
            if (confirm('Bu eğitimi silmek istediğinize emin misiniz?')) {
                $.ajax({
                    url: '/Course/Delete',
                    type: 'POST',
                    data: { id: id },
                    success: function (response) {
                        if (response.success) {
                            location.reload();
                        } else {
                            alert("Hata: " + response.message);
                        }
                    },
                    error: function () {
                        alert("Hata oluştu.");
                    }
                });
            }
        }
    </script>
}