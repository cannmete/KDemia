@model List<KDemia.Models.Course>

@{
    ViewData["Title"] = "Eğitim Listesi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .course-card {
        transition: all 0.3s ease-in-out;
        border: 1px solid #eee;
        border-radius: 10px;
        overflow: hidden;
        background: #fff;
        height: 100%; /* Kartların boyunu eşitlemek için */
    }

        .course-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            z-index: 10;
            cursor: pointer;
        }

    .course-img-wrapper {
        height: 180px;
        overflow: hidden;
        position: relative;
    }

        .course-img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .category-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: 600;
    }

    .instructor-info {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 13px;
        color: #777;
    }

        .instructor-info i {
            margin-right: 5px;
            color: #0088cc;
        }
</style>

<section class="card">
    <header class="card-header">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h2 class="card-title">Eğitim Listesi</h2>
            </div>
            <div class="col-md-6 text-right" style="text-align: right;">
                <a href="/Course/Create" class="btn btn-primary btn-success">
                    <i class="fas fa-plus"></i> Yeni Eğitim Ekle
                </a>
            </div>
        </div>
    </header>

    <div class="card-body" style="background-color: #f6f7f9;">

        <div class="row mb-4">
            <div class="col-lg-12">
                <form method="get" action="/Course/Index">
                    <div class="card p-3 shadow-sm border-0">
                        <div class="row">
                            <div class="col-md-5 mb-2 mb-md-0">
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-0"><i class="fas fa-search"></i></span>
                                    <input type="text" name="search" class="form-control border-0 bg-light"
                                           placeholder="Eğitim adı veya açıklama ara..."
                                           value="@ViewBag.CurrentSearch">
                                </div>
                            </div>

                            <div class="col-md-4 mb-2 mb-md-0">
                                <select name="categoryId" class="form-control border-0 bg-light" asp-items="ViewBag.Categories">
                                    <option value="">-- Tüm Kategoriler --</option>
                                </select>
                            </div>

                            <div class="col-md-3">
                                <button type="submit" class="btn btn-secondary btn-block w-100">
                                    Filtrele
                                </button>
                                @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch) || ViewBag.CurrentCategory != null)
                                {
                                    <a href="/Course/Index" class="btn btn-link btn-sm btn-block text-danger mt-1">
                                        Filtreleri Temizle
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            @foreach (var item in Model)
            {
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="course-card">

                        <div class="course-img-wrapper">
                            <span class="category-badge">
                                @(item.Category?.Name ?? "Genel")
                            </span>
                        </div>

                        <div class="p-3 d-flex flex-column" style="height: calc(100% - 180px);">
                            <h5 class="font-weight-bold mb-2 text-dark" style="font-size: 16px;">
                                @(item.Title.Length > 40 ? item.Title.Substring(0, 40) + "..." : item.Title)
                            </h5>

                            <div class="instructor-info">
                                <i class="fas fa-user-circle"></i>
                                <span>@(item.User?.FullName ?? "Bilinmiyor")</span>
                            </div>

                            <p class="text-muted mb-3 flex-grow-1" style="font-size: 13px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                @(item.ShortDescription ?? "Açıklama bulunmuyor.")
                            </p>

                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="text-warning small">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                                </div>
                                <div class="font-weight-bold text-primary">
                                    @item.Price.ToString("C2")
                                </div>
                            </div>

                            <div class="border-top pt-3 d-flex justify-content-between">
                                @if (!string.IsNullOrEmpty(item.VideoUrl))
                                {
                                    <a href="@item.VideoUrl" target="_blank" class="btn btn-xs btn-outline-danger">
                                        <i class="fab fa-youtube"></i> İzle
                                    </a>
                                }
                                else
                                {
                                    <button class="btn btn-xs btn-light" disabled>Video Yok</button>
                                }

                                <div>
                                    <a href="/Course/Edit/@item.Id" class="btn btn-xs btn-warning text-white mr-1">
                                        <i class="fas fa-pencil-alt"></i>
                                    </a>
                                    <button onclick="deleteCourse(@item.Id)" class="btn btn-xs btn-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        @if (Model.Count == 0)
        {
            <div class="alert alert-warning text-center p-4">
                <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <h4>Sonuç Bulunamadı</h4>
                <p>Aradığınız kriterlere uygun bir eğitim bulunmamaktadır.</p>
                <a href="/Course/Index" class="btn btn-dark btn-sm">Tüm Eğitimleri Göster</a>
            </div>
        }

    </div>
</section>

@section Scripts {
    <script>
        function deleteCourse(id) {
            if (confirm('Bu eğitimi silmek istediğinize emin misiniz?')) {
                $.ajax({
                    url: '/Course/Delete',
                    type: 'POST',
                    data: { id: id },
                    success: function (response) {
                        if (response.success) {
                            location.reload();
                        } else {
                            alert("Hata: " + response.message);
                        }
                    },
                    error: function () {
                        alert("Hata oluştu.");
                    }
                });
            }
        }
    </script>
}